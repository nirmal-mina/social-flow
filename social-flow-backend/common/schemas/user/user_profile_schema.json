{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://socialflow.com/schemas/user/user_profile_schema.json",
  "title": "UserProfile",
  "description": "Canonical user profile document. Contains both public and internal fields. Use this as the single source-of-truth for user metadata across services.",
  "type": "object",
  "required": ["user_id", "created_at", "username", "display_name", "status"],
  "additionalProperties": false,
  "properties": {
    "user_id": {
      "type": "string",
      "format": "uuid",
      "description": "Stable unique identifier for the user (system-generated, never changes)."
    },
    "username": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9._-]{3,30}$",
      "description": "Public handle. Immutable history recorded elsewhere if changed; must be unique."
    },
    "display_name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "description": "Human-readable name shown in the UI; can be changed."
    },
    "bio": {
      "type": "string",
      "maxLength": 2000,
      "description": "User-provided biography. May contain markdown or limited HTML in rendering layer."
    },
    "avatar": {
      "type": "object",
      "description": "Avatar / profile image metadata.",
      "properties": {
        "url": { "type": "string", "format": "uri" },
        "thumbnail_url": { "type": "string", "format": "uri" },
        "width": { "type": "integer", "minimum": 1 },
        "height": { "type": "integer", "minimum": 1 },
        "mime_type": { "type": "string" }
      },
      "required": ["url"]
    },
    "contact": {
      "type": "object",
      "description": "Public/verified contact points. Do NOT store unverified sensitive PII here unless flagged.",
      "properties": {
        "email_verified": { "type": "boolean", "default": false },
        "phone_verified": { "type": "boolean", "default": false },
        "emails": {
          "type": "array",
          "items": { "type": "string", "format": "email" },
          "description": "All user email addresses (include verification status in account_schema)."
        },
        "phones": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Phone numbers in E.164 when available."
        }
      },
      "additionalProperties": false
    },
    "created_at": { "type": "string", "format": "date-time", "description": "UTC creation timestamp." },
    "last_modified": { "type": "string", "format": "date-time", "description": "Last time profile fields were updated." },
    "metadata": {
      "type": "object",
      "description": "Freeform key/value for service-specific metadata (do not use for sensitive data).",
      "additionalProperties": true
    },
    "status": {
      "type": "object",
      "required": ["account_state"],
      "properties": {
        "account_state": {
          "type": "string",
          "enum": ["active", "suspended", "deleted", "pending_verification", "banned"],
          "description": "High-level state used by access-control and UI flows."
        },
        "suspended_until": { "type": ["string", "null"], "format": "date-time", "description": "If suspended, optional lift time." },
        "ban_reason": { "type": ["string", "null"], "maxLength": 2000 }
      },
      "additionalProperties": false
    },
    "public_flags": {
      "type": "array",
      "description": "Non-sensitive flags that can be displayed in public profile (verified badge, creator status, etc.)",
      "items": { "type": "string" },
      "default": []
    },
    "private_flags": {
      "type": "array",
      "description": "Internal-only flags (e.g., fraud_suspected). Not to be exposed to end-user UI.",
      "items": { "type": "string" },
      "default": []
    }
  }
}
