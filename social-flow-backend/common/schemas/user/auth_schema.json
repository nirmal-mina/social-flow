{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://socialflow.com/schemas/user/auth_schema.json",
  "title": "AuthenticationMetadata",
  "description": "Authentication-specific metadata. Split into its own doc for stricter access control and rotation policies.",
  "type": "object",
  "required": ["user_id"],
  "additionalProperties": false,
  "properties": {
    "user_id": { "type": "string", "format": "uuid" },
    "mfa": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "methods": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": { "type": "string", "enum": ["totp", "sms", "webauthn", "u2f", "push"] },
              "configured_at": { "type": "string", "format": "date-time" },
              "last_used": { "type": ["string", "null"], "format": "date-time" },
              "label": { "type": "string" }
            },
            "required": ["type", "configured_at"]
          },
          "default": []
        }
      }
    },
    "recovery_codes": {
      "type": "array",
      "description": "Encrypted recovery codes (store encrypted, redact at read-time).",
      "items": { "type": "string" },
      "default": []
    },
    "password_reset": {
      "type": "object",
      "properties": {
        "last_requested_at": { "type": ["string", "null"], "format": "date-time" },
        "reset_token_id": { "type": ["string", "null"], "description": "Reference to ephemeral reset token in token store." }
      }
    },
    "suspicious_activity": {
      "type": "object",
      "description": "Signals useful to auth service for risk scoring.",
      "properties": {
        "failed_login_count": { "type": "integer", "minimum": 0, "default": 0 },
        "last_failed_login": { "type": ["string", "null"], "format": "date-time" },
        "unusual_ip": { "type": "boolean", "default": false }
      }
    }
  }
}
