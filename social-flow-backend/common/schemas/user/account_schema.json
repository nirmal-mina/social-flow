{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://socialflow.com/schemas/user/account_schema.json",
  "title": "Account",
  "description": "Account and identity details. Separated from profile to allow different access controls and storage lifecycles (PII vs public profile).",
  "type": "object",
  "required": ["user_id", "primary_email", "email_verified", "created_at"],
  "additionalProperties": false,
  "properties": {
    "user_id": { "type": "string", "format": "uuid" },
    "primary_email": { "type": "string", "format": "email" },
    "secondary_emails": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["email", "verified"],
        "properties": {
          "email": { "type": "string", "format": "email" },
          "verified": { "type": "boolean" },
          "added_at": { "type": "string", "format": "date-time" }
        },
        "additionalProperties": false
      },
      "default": []
    },
    "email_verified": { "type": "boolean", "description": "Whether primary_email is verified." },
    "phone_numbers": {
      "type": "array",
      "items": {
        "type": "object",
        "properties": {
          "number": { "type": "string" },
          "verified": { "type": "boolean" },
          "added_at": { "type": "string", "format": "date-time" },
          "label": { "type": "string" }
        },
        "required": ["number", "verified"]
      },
      "default": []
    },
    "identity_providers": {
      "type": "array",
      "description": "External auth providers (OAuth, SAML) linked to this account.",
      "items": {
        "type": "object",
        "required": ["provider", "provider_id", "linked_at"],
        "properties": {
          "provider": { "type": "string", "description": "e.g., google, facebook, apple, okta" },
          "provider_id": { "type": "string", "description": "Unique id from provider" },
          "linked_at": { "type": "string", "format": "date-time" },
          "scopes": { "type": "array", "items": { "type": "string" } }
        },
        "additionalProperties": false
      },
      "default": []
    },
    "account_tier": {
      "type": "string",
      "enum": ["free", "pro", "enterprise"],
      "default": "free"
    },
    "billing_customer_id": {
      "type": ["string", "null"],
      "description": "Link to billing system (do not embed billing details here)."
    },
    "created_at": { "type": "string", "format": "date-time" },
    "last_login_at": { "type": ["string", "null"], "format": "date-time" },
    "password_meta": {
      "type": "object",
      "description": "Password and security metadata; do NOT store raw password. Forwards-compatible with hashed+pepper schemes.",
      "properties": {
        "hash_algorithm": { "type": "string", "description": "e.g., argon2id" },
        "hash": { "type": "string", "description": "Base64 or structured encrypted blob" },
        "salt": { "type": "string" },
        "pepper_version": { "type": "string" },
        "updated_at": { "type": "string", "format": "date-time" }
      },
      "required": ["hash_algorithm", "hash"]
    },
    "account_locale": { "type": "string", "description": "User's preferred locale (BCP-47)." }
  }
}
