# =========================
# File: testing/security/vulnerability/parsers/requirements_parser.py
"""
Simple requirements.txt parser that handles common pip specifiers
Returns list of dicts: {"name": pkg, "version": ver_or_none}
"""
import re
from pathlib import Path

REQ_LINE = re.compile(r"^\s*([a-zA-Z0-9_\-\.]+)(?:[<>=!~]=?\s*([^\s;,#]+))?")

def parse_requirements(path: Path):
    deps = []
    with open(path, "r", encoding="utf-8", errors="ignore") as f:
        for line in f:
            line = line.strip()
            if not line or line.startswith("#") or line.startswith("-e") or line.startswith("--"):
                continue
            m = REQ_LINE.match(line)
            if m:
                name = m.group(1)
                ver = m.group(2) or None
                deps.append({"name": name, "version": ver})
    return deps
